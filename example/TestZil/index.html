
<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<meta name="format-detection" content="telephone=no"/>
<meta name="format-detection" content="email=no"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no" />
<title></title>

</head>
<body>
<div id="root">
<h1>This is Laksa.js simple example</h1>

<h3>Current Provider is:</h3>
<h4 id="currenProvider">http://localhost:4200 </h4>
<input id="nodeUrl" value="http://localhost:4200" />
<button id="setProviderButton">Set Provider</button>
</div>
<script src="../../dist/Laksa.browser.js"></script>
<script>

var currenProvider=document.getElementById('nodeUrl').value
var setButton=document.getElementById('setProviderButton')
//For local testing, use URL = 'http://localhost:4200'
//To connect to the external network, use URL = 'https://api-scilla.zilliqa.com'
var Laksa =new Laksa(currenProvider)

// var URL = undefined


setButton.onclick=function(e){
  console.log('lll')
};

var URL ='https://api-scilla.zilliqa.com'
Laksa.setProvider(URL)
// webz.isConnected().then(console.log)
let code = `
(* HelloWorld contract *)

import ListUtils

(***************************************************)
(*               Associated library                *)
(***************************************************)
library HelloWorld

let one_msg =
  fun (msg : Message) =>
  let nil_msg = Nil {Message} in
  Cons {Message} msg nil_msg

let not_owner_code = Int32 1
let set_hello_code = Int32 2

(***************************************************)
(*             The contract definition             *)
(***************************************************)

contract HelloWorld
(dummy: String)

field welcome_msg : String = ""

transition setHello (msg : String)
    welcome_msg := msg;
    msg = {_tag : "Main"; _recipient : _sender; _amount : Uint128 0; code : set_hello_code};
    msgs = one_msg msg;
    send msgs
end


transition getHello ()
    r <- welcome_msg;
    msg = {_tag : "Main"; _recipient : _sender; _amount : Uint128 0; msg : r};
    msgs = one_msg msg;
    send msgs
end
`
//
// the immutable initialisation variables
let initParams = [
  {
    vname: "dummy",
    type: "String",
    value: `ASDF`
  }
];

let txnDetails = {
  version: 0,
  nonce: 2,
  to: "0000000000000000000000000000000000000000",
  amount: Laksa.util.toBN(0),
  gasPrice: 1,
  gasLimit: 50,
  code: code,
  data: JSON.stringify(initParams).replace(/\\"/g, '"')
};

// sign the transaction using util methods
let txn = Laksa.util.createTransactionJson(
  "e19d05c5452598e24caad4a0d85a49146f7be089515c905ae6a19e8a578a6930",
  txnDetails
);

const myAddress = { address: "9bfec715a6bd658fcb62b0f8cc9bfa2ade71434a" };
// with callback
// Laksa.zil.getBalance(myAddress, callback);
Laksa.zil.getSmartContracts(myAddress,(err,data)=>{
  if(data.length>0){
    data.map(d=>{
      Laksa.zil.getSmartContractState({address:d.address},(err,data)=>{
        console.log({smartContractState:data});
      })
      Laksa.zil.getSmartContractCode({address:d.address},(err,data)=>{
        console.log({smartContractCode:data});
      })
      Laksa.zil.getSmartContractInit({address:d.address},(err,data)=>{
        console.log({smartContractInit:data})
      })
    })
  }
});

// send the transaction to the node
// Laksa.zil.createTransaction(txn, callback);

function callback(err, data) {
  console.log({ err, data });
}
</script>
</body>
</html>
